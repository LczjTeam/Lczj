<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>树形视图</title>
    <link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.5" rel="stylesheet">
    <link href="css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
    <link href="css/plugins/jsTree/style.min.css" rel="stylesheet">
    <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">

    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/style.min.css?v=4.0.0" rel="stylesheet"><base target="_blank">

</head>

<body class="gray-bg">
<div class="wrapper wrapper-content  animated fadeInRight">


    <div class="row">

        <div class="col-sm-4">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>JSON示例</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content" style="min-height: 450px;">

                    <div id="using_json"></div>

                </div>
            </div>
        </div>
        <div class="col-sm-8">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>JSON示例</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>

                <div class="spiner-example" id="loading-menu">
                    <div class="sk-spinner sk-spinner-wave">
                        <div class="sk-rect1"></div>
                        <div class="sk-rect2"></div>
                        <div class="sk-rect3"></div>
                        <div class="sk-rect4"></div>
                        <div class="sk-rect5"></div>
                    </div>
                </div>

                <div class="ibox-content" style="min-height: 450px;">

                    <form class="form-horizontal m-t" id="commentForm">
                        <div class="form-group">
                            <label class="col-sm-3 control-label" >ID:</label>
                            <div class="col-sm-8">
                                <input id="munu_title" name="name" minlength="2" type="text" class="form-control" required="" aria-required="true">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">title</label>
                            <div class="col-sm-8">
                                <input id="title" type="" class="form-control" name="email" required="" aria-required="true">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">parents</label>
                            <div class="col-sm-8">
                                <select id="parents1" class="form-control" >
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">URL:</label>
                            <div class="col-sm-8">
                                <input id="url" type="url" class="form-control" name="email" required="" aria-required="true">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Method:</label>
                            <div class="col-sm-8">
                                <input id="method" type="" class="form-control" name="url">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">sort no:</label>
                            <div class="col-sm-8">
                                <input id="sort_no" type="" class="form-control" name="url">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">visible:</label>
                            <div class="col-sm-8">
                                <!--<input id="visible" type="url" class="form-control" name="url">-->
                                <select id="visible" class="form-control" >
                                    <option value="1">显示</option>
                                    <option value="0">隐藏</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">css:</label>
                            <div class="col-sm-8">
                                <input id="css" type="" class="form-control" name="url">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-3">
                                <a id="btn_alter_menu" class="btn btn-primary" >提交</a>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery.min.js?v=2.1.4"></script>
<script src="js/bootstrap.min.js?v=3.3.5"></script>
<script src="js/content.min.js?v=1.0.0"></script>
<script src="js/plugins/jsTree/jstree.min.js"></script>
<script src="js/plugins/sweetalert/sweetalert.min.js"></script>

<style>
    .jstree-open>.jstree-anchor>.fa-folder:before{content:"\f07c"}.jstree-default .jstree-icon.none{width:0}
</style>
<script>

$(document).ready(function () {

        //右侧选择根目录
        var params = {};
        $.ajax({
        async: false,
        type: "POST",
        url: "../menu/roots",//注意路径
        data: params,
        dataType: "json",
        success: function (data) {
            console.log(JSON.stringify(data, null, 4));
            var str ='<option value="0">根目录</option>';
            for (var i = 0; i < data.length; i++) {
                str+='<option value="'+data[i].menu+'"> '+data[i].title+'  </option>'
            }
                $("#parents1").html(str);
        },
        error: function (data) {
            console.log(JSON.stringify(data, null, 4));
            swal({
                title: "数据获取失败！",
                text: "",
                type: "error",
                allowOutsideClick: true,
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "OK",
            });
        }
    });
         //左侧
        var dataTank = [];//创建容器
        refreshTree();
        function  refreshTree() {
            var params = {};

            $.ajax({
                async: false,
                type: "POST",
                url: "../menu/list",//注意路径
                data: params,
                dataType: "json",
                success: function (data) {

                    console.log(JSON.stringify(data, null, 4));
                    var oldData = data;//获取Json数据
                    for (var i = 0; i < oldData.length; i++) { //提取所需值组成新数组
                        var item = {};
                        var itm = oldData[i];
                        item.id = itm.menu.menu;
                        item.text = itm.menu.title;
                        item.children = [];

                        for (var k = 0; k < itm.menus.length; k++) {
                            var itms = itm.menus[k];
                            var curt = {};
                            curt.id = itms.menu;
                            curt.text = itms.title;
                            item.children.push(curt);
                        }
                        dataTank.push(item);
                    }
                },
                error: function (data) {
                    console.log(JSON.stringify(data, null, 4));
                    //alert("数据获取失败 ！");
                    swal({
                        title: "数据获取失败！",
                        text: "",
                        type: "error",
                        allowOutsideClick: true,
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "OK",
                    });
                }
            });

        }
        //初始化树
        $('#using_json').data('jstree', false);
        $("#loading-menu").css('display', 'none');
        $("#using_json").jstree({

            'plugins': ["wholerow", "types"],
            'core': {
                "themes": {
                    "responsive": false
                },
                'data': dataTank
            },
            "types": {
                "default": {
                    "icon": "fa fa-folder icon-state-warning icon-lg"
                },
                "file": {
                    "icon": "fa fa-file icon-state-warning icon-lg"
                }
            }

        });
        //点击事件
        $('#using_json').on("changed.jstree", function (e, data) {

            var  id= data.selected;
            var params={};
            params.menu = ''+id ;
            $.ajax({
                async: false,
                type: "POST",
                url: "../menu/loadById",//注意路径
                data: params,
                dataType: "json",
                success: function (data) {
                    console.log(JSON.stringify(data,null,4));
                    var showdata = data;

                   $("#munu_title").val(showdata.menu);
                   $("#title").val(showdata.title);
                    $("#url").val(showdata.url);
                    if(showdata.parents=='0'){
                        $("#parents1").attr('disabled','true');
                    }else{
                        $("#parents1").removeAttr('disabled');
                    }
                    $("#parents1").val(showdata.parents);
                    $("#method").val(showdata.method);
                    $("#sort_no").val(showdata.sort_no);
                    $("#css").val(showdata.css);
                    $("#visible").val(showdata.visible);

                }, error: function (data) {
                    console.log(JSON.stringify(data,null,4));
                    //alert("数据获取失败 ！");
                    swal({
                        title: "数据获取失败！",
                        text: "",
                        type: "error",
                        allowOutsideClick: true,
                        showConfirmButton: true,
                        showCancelButton: false,
                        confirmButtonClass: "btn-danger",
                        confirmButtonText: "OK",
                    });
                }
            });
        });

        //刷新树【当data发生改变时】
        function refresh(){
            refreshTree();
            var tree = $('#using_json');
            tree.jstree(true).settings.core.data = data;
            tree.jstree(true).refresh(); //刷新树

        }

        //提交按钮，进行修改
        $("#btn_alter_menu").click(function(e){
        var delok = true;
        var params={};
        params.menu = $("#munu_title").val();
        params.title =$('#title').val();
        params.parents =$('#parents').val();
        params.url =$('#url').val();
        params.method =$('#method').val();
        params.sort_no =$('#sort_no').val();
        params.visible =$('#visible').val();
        params.css =$('#css').val();
        $.ajax({
            async: false,
            type: "POST",
            url: "../menu/update",//注意路径
            data: params,
            dataType: "json",
            success: function (data) {
                if (data) {

                    return;
                } else {
                    delok = false;
                }
            },
            error: function (data) {
                delok = false;
            }
        });
        if (!delok) {
            swal({
                title: "保存失败！",
                text: "",
                type: "error",
                allowOutsideClick: true,
                showConfirmButton: true,
                showCancelButton: false,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "OK",
            });
            return;
        }

        swal({
            title: "保存成功！",
            text: "",
            type: "success",
            allowOutsideClick: true,
            showConfirmButton: true,
            showCancelButton: false,
            confirmButtonClass: "btn-success",
            confirmButtonText: "OK",
        });


    });

});




</script>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=9051096" charset="UTF-8"></script>
</body>

</html>